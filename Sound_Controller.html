<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Sound Controller - Pan Docs</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="The single, most comprehensive technical reference to Game Boy available to the public.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <!-- Open Graph tags-->
        <meta name="og:site_name" content="summary" />
        <meta name="og:image" content="https://gbdev.io/pandocs/favicon.png" />
        <meta name="og:title" content="Sound Controller - Pan Docs" />
        <meta name="og:description" content="The single, most comprehensive technical reference to Game Boy available to the public." />

        <!-- Twitter meta tags -->
        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@gbdev0" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="custom/style.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="About.html">Foreword</a></li><li class="chapter-item affix "><a href="Authors.html">Acknowledgements</a></li><li class="chapter-item affix "><a href="History.html">History</a></li><li class="spacer"></li><li class="chapter-item affix "><li class="part-title">Overview</li><li class="chapter-item "><a href="Specifications.html"><strong aria-hidden="true">1.</strong> Specifications</a></li><li class="chapter-item "><a href="Memory_Map.html"><strong aria-hidden="true">2.</strong> Memory Map</a></li><li class="chapter-item affix "><li class="part-title">I/O Ports</li><li class="chapter-item "><a href="Rendering.html"><strong aria-hidden="true">3.</strong> Rendering</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Tile_Data.html"><strong aria-hidden="true">3.1.</strong> Tile Data</a></li><li class="chapter-item "><a href="Tile_Maps.html"><strong aria-hidden="true">3.2.</strong> Tile Maps</a></li><li class="chapter-item "><a href="OAM.html"><strong aria-hidden="true">3.3.</strong> OAM</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="OAM_DMA_Transfer.html"><strong aria-hidden="true">3.3.1.</strong> OAM DMA Transfer</a></li></ol></li><li class="chapter-item "><a href="LCDC.html"><strong aria-hidden="true">3.4.</strong> LCD Control</a></li><li class="chapter-item "><a href="STAT.html"><strong aria-hidden="true">3.5.</strong> LCD Status</a></li><li class="chapter-item "><a href="Scrolling.html"><strong aria-hidden="true">3.6.</strong> Scrolling</a></li><li class="chapter-item "><a href="Palettes.html"><strong aria-hidden="true">3.7.</strong> Palettes</a></li><li class="chapter-item "><a href="pixel_fifo.html"><strong aria-hidden="true">3.8.</strong> Pixel FIFO</a></li></ol></li><li class="chapter-item expanded "><a href="Sound_Controller.html" class="active"><strong aria-hidden="true">4.</strong> Sound Controller</a></li><li class="chapter-item "><a href="Joypad_Input.html"><strong aria-hidden="true">5.</strong> Joypad Input</a></li><li class="chapter-item "><a href="Serial_Data_Transfer_(Link_Cable).html"><strong aria-hidden="true">6.</strong> Serial Data Transfer</a></li><li class="chapter-item "><a href="Timer_and_Divider_Registers.html"><strong aria-hidden="true">7.</strong> Timer and Divider Registers</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Timer_Obscure_Behaviour.html"><strong aria-hidden="true">7.1.</strong> Timer Obscure Behaviour</a></li></ol></li><li class="chapter-item "><a href="Interrupts.html"><strong aria-hidden="true">8.</strong> Interrupts</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Interrupt_Sources.html"><strong aria-hidden="true">8.1.</strong> Interrupt Sources</a></li><li class="chapter-item "><a href="halt.html"><strong aria-hidden="true">8.2.</strong> HALT</a></li></ol></li><li class="chapter-item "><a href="CGB_Registers.html"><strong aria-hidden="true">9.</strong> CGB Registers</a></li><li class="chapter-item "><a href="IR.html"><strong aria-hidden="true">10.</strong> Infrared Communication</a></li><li class="chapter-item "><a href="SGB_Functions.html"><strong aria-hidden="true">11.</strong> SGB Functions</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="SGB_Unlocking.html"><strong aria-hidden="true">11.1.</strong> Unlocking and Detecting SGB Functions</a></li><li class="chapter-item "><a href="SGB_Command_Packet.html"><strong aria-hidden="true">11.2.</strong> Command Packet Transfers</a></li><li class="chapter-item "><a href="SGB_VRAM_Transfer.html"><strong aria-hidden="true">11.3.</strong> VRAM Transfers</a></li><li class="chapter-item "><a href="SGB_Color_Palettes.html"><strong aria-hidden="true">11.4.</strong> Color Palettes Overview</a></li><li class="chapter-item "><a href="SGB_Command_Summary.html"><strong aria-hidden="true">11.5.</strong> Command Summary</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="SGB_Command_Pallete.html"><strong aria-hidden="true">11.5.1.</strong> Palette Commands</a></li><li class="chapter-item "><a href="SGB_Command_Attribute.html"><strong aria-hidden="true">11.5.2.</strong> Color Attribute Commands</a></li><li class="chapter-item "><a href="SGB_Command_Sound.html"><strong aria-hidden="true">11.5.3.</strong> Sound Functions</a></li><li class="chapter-item "><a href="SGB_Command_System.html"><strong aria-hidden="true">11.5.4.</strong> System Control Commands</a></li><li class="chapter-item "><a href="SGB_Command_Multiplayer.html"><strong aria-hidden="true">11.5.5.</strong> Multiplayer Command</a></li><li class="chapter-item "><a href="SGB_Command_Border.html"><strong aria-hidden="true">11.5.6.</strong> Border and OBJ Commands</a></li><li class="chapter-item "><a href="SGB_Command_Undocumented.html"><strong aria-hidden="true">11.5.7.</strong> Undocumented SGB commands</a></li></ol></li></ol></li><li class="chapter-item "><li class="part-title">CPU Specifications</li><li class="chapter-item "><a href="CPU_Registers_and_Flags.html"><strong aria-hidden="true">12.</strong> CPU Registers and Flags</a></li><li class="chapter-item "><a href="CPU_Instruction_Set.html"><strong aria-hidden="true">13.</strong> CPU Instruction Set</a></li><li class="chapter-item "><a href="CPU_Comparison_with_Z80.html"><strong aria-hidden="true">14.</strong> CPU Comparison with Z80</a></li><li class="chapter-item affix "><li class="part-title">Cartridges</li><li class="chapter-item "><a href="The_Cartridge_Header.html"><strong aria-hidden="true">15.</strong> The Cartridge Header</a></li><li class="chapter-item "><a href="MBCs.html"><strong aria-hidden="true">16.</strong> MBCs</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="nombc.html"><strong aria-hidden="true">16.1.</strong> No MBC</a></li><li class="chapter-item "><a href="MBC1.html"><strong aria-hidden="true">16.2.</strong> MBC1</a></li><li class="chapter-item "><a href="MBC2.html"><strong aria-hidden="true">16.3.</strong> MBC2</a></li><li class="chapter-item "><a href="MBC3.html"><strong aria-hidden="true">16.4.</strong> MBC3</a></li><li class="chapter-item "><a href="MBC5.html"><strong aria-hidden="true">16.5.</strong> MBC5</a></li><li class="chapter-item "><a href="MBC6.html"><strong aria-hidden="true">16.6.</strong> MBC6</a></li><li class="chapter-item "><a href="MBC7.html"><strong aria-hidden="true">16.7.</strong> MBC7</a></li><li class="chapter-item "><a href="HuC1.html"><strong aria-hidden="true">16.8.</strong> HuC1</a></li><li class="chapter-item "><a href="othermbc.html"><strong aria-hidden="true">16.9.</strong> Other MBCs</a></li></ol></li><li class="chapter-item "><li class="part-title">Accessories</li><li class="chapter-item "><a href="Gameboy_Printer.html"><strong aria-hidden="true">17.</strong> Game Boy Printer</a></li><li class="chapter-item "><a href="Gameboy_Camera.html"><strong aria-hidden="true">18.</strong> Game Boy Camera</a></li><li class="chapter-item "><a href="Four_Player_Adapter.html"><strong aria-hidden="true">19.</strong> 4-Player Adapter</a></li><li class="chapter-item "><a href="Shark_Cheats.html"><strong aria-hidden="true">20.</strong> Game Genie/Shark Cheats</a></li><li class="chapter-item affix "><li class="part-title">Other</li><li class="chapter-item "><a href="Power_Up_Sequence.html"><strong aria-hidden="true">21.</strong> Power-Up Sequence</a></li><li class="chapter-item "><a href="Reducing_Power_Consumption.html"><strong aria-hidden="true">22.</strong> Reducing Power Consumption</a></li><li class="chapter-item "><a href="Accessing_VRAM_and_OAM.html"><strong aria-hidden="true">23.</strong> Accessing VRAM and OAM</a></li><li class="chapter-item "><a href="OAM_Corruption_Bug.html"><strong aria-hidden="true">24.</strong> OAM Corruption Bug</a></li><li class="chapter-item "><a href="External_Connectors.html"><strong aria-hidden="true">25.</strong> External Connectors</a></li><li class="chapter-item "><a href="GBC_Approval_Process.html"><strong aria-hidden="true">26.</strong> GBC Approval Process</a></li><li class="spacer"></li><li class="chapter-item affix "><a href="References.html">References</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Pan Docs</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/gbdev/pandocs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/gbdev/pandocs/edit/master/src/Sound_Controller.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="sound-controller"><a class="header" href="#sound-controller">Sound Controller</a></h1>
<p>There are two sound channels connected to the output terminals SO1 and
SO2. There is also an input terminal Vin connected to the cartridge. It
can be routed to either of both output terminals. Game Boy circuitry
allows producing sound in four different ways:</p>
<ul>
<li>Quadrangular wave patterns with sweep and envelope functions (CH1)</li>
<li>Quadrangular wave patterns with envelope functions (CH2)</li>
<li>Voluntary wave patterns from wave RAM (CH3)</li>
<li>White noise with an envelope function (CH4)</li>
</ul>
<p>These four sounds can be controlled independently and then mixed
separately for each of the output terminals.</p>
<p>Sound registers may be set at all times while producing sound.</p>
<p>(Sounds will have a 2.4% higher frequency on Super GB.)</p>
<h2 id="sound-channel-1---tone--sweep"><a class="header" href="#sound-channel-1---tone--sweep">Sound Channel 1 - Tone &amp; Sweep</a></h2>
<h3 id="ff10---nr10---channel-1-sweep-register-rw"><a class="header" href="#ff10---nr10---channel-1-sweep-register-rw">FF10 - NR10 - Channel 1 Sweep register (R/W)</a></h3>
<pre><code> Bit 6-4 - Sweep Time
 Bit 3   - Sweep Increase/Decrease
            0: Addition    (frequency increases)
            1: Subtraction (frequency decreases)
 Bit 2-0 - Number of sweep shift (n: 0-7)
</code></pre>
<p>Sweep Time:</p>
<table><thead><tr><th>Value (binary)</th><th>Description</th></tr></thead><tbody>
<tr><td>000</td><td>sweep off - no freq change</td></tr>
<tr><td>001</td><td>7.8 ms  (1/128Hz)</td></tr>
<tr><td>010</td><td>15.6 ms (2/128Hz)</td></tr>
<tr><td>011</td><td>23.4 ms (3/128Hz)</td></tr>
<tr><td>100</td><td>31.3 ms (4/128Hz)</td></tr>
<tr><td>101</td><td>39.1 ms (5/128Hz)</td></tr>
<tr><td>110</td><td>46.9 ms (6/128Hz)</td></tr>
<tr><td>111</td><td>54.7 ms (7/128Hz)</td></tr>
</tbody></table>
<p>The change of frequency (NR13,NR14) at each shift is calculated by the
following formula where X(0) is initial freq &amp; X(t-1) is last freq:</p>
<p>X(t) = X(t-1) +/- X(t-1)/2^n</p>
<h3 id="ff11---nr11---channel-1-sound-lengthwave-pattern-duty-rw"><a class="header" href="#ff11---nr11---channel-1-sound-lengthwave-pattern-duty-rw">FF11 - NR11 - Channel 1 Sound length/Wave pattern duty (R/W)</a></h3>
<pre><code>Bit 7-6 - Wave Pattern Duty (Read/Write)
Bit 5-0 - Sound length data (Write Only) (t1: 0-63)
</code></pre>
<table><thead><tr><th>Bits 7-6</th><th>Wave duty</th></tr></thead><tbody>
<tr><td>%00</td><td>12.5% (<code>_-------_-------_-------</code>)</td></tr>
<tr><td>%01</td><td>25%   (<code>__------__------__------</code>)</td></tr>
<tr><td>%10</td><td>50%   (<code>____----____----____----</code>) (normal)</td></tr>
<tr><td>%11</td><td>75%   (<code>______--______--______--</code>)</td></tr>
</tbody></table>
<p>Sound Length = (64-t1)*(1/256) seconds. The Length value is used only if
Bit 6 in NR14 is set.</p>
<h3 id="ff12---nr12---channel-1-volume-envelope-rw"><a class="header" href="#ff12---nr12---channel-1-volume-envelope-rw">FF12 - NR12 - Channel 1 Volume Envelope (R/W)</a></h3>
<pre><code> Bit 7-4 - Initial Volume of envelope (0-0Fh) (0=No Sound)
 Bit 3   - Envelope Direction (0=Decrease, 1=Increase)
 Bit 2-0 - Number of envelope sweep (n: 0-7)
           (If zero, stop envelope operation.)
</code></pre>
<p>Length of 1 step = n*(1/64) seconds</p>
<h3 id="ff13---nr13---channel-1-frequency-lo-write-only"><a class="header" href="#ff13---nr13---channel-1-frequency-lo-write-only">FF13 - NR13 - Channel 1 Frequency lo (Write Only)</a></h3>
<p>Lower 8 bits of 11 bit frequency (x). Next 3 bit are in NR14 ($FF14)</p>
<h3 id="ff14---nr14---channel-1-frequency-hi-rw"><a class="header" href="#ff14---nr14---channel-1-frequency-hi-rw">FF14 - NR14 - Channel 1 Frequency hi (R/W)</a></h3>
<pre><code>Bit 7   - Initial (1=Restart Sound)     (Write Only)
Bit 6   - Counter/consecutive selection (Read/Write)
          (1=Stop output when length in NR11 expires)
Bit 2-0 - Frequency's higher 3 bits (x) (Write Only)
</code></pre>
<p>Frequency = 131072/(2048-x) Hz</p>
<h2 id="sound-channel-2---tone"><a class="header" href="#sound-channel-2---tone">Sound Channel 2 - Tone</a></h2>
<p>This sound channel works exactly as channel 1, except that it doesn’t
have a Tone Envelope/Sweep Register.</p>
<h3 id="ff16---nr21---channel-2-sound-lengthwave-pattern-duty-rw"><a class="header" href="#ff16---nr21---channel-2-sound-lengthwave-pattern-duty-rw">FF16 - NR21 - Channel 2 Sound Length/Wave Pattern Duty (R/W)</a></h3>
<pre><code>Bit 7-6 - Wave Pattern Duty (Read/Write)
Bit 5-0 - Sound length data (Write Only) (t1: 0-63)
</code></pre>
<table><thead><tr><th>Bits 7-6</th><th>Wave duty</th></tr></thead><tbody>
<tr><td>%00</td><td>12.5% (<code>_-------_-------_-------</code>)</td></tr>
<tr><td>%01</td><td>25%   (<code>__------__------__------</code>)</td></tr>
<tr><td>%10</td><td>50%   (<code>____----____----____----</code>) (normal)</td></tr>
<tr><td>%11</td><td>75%   (<code>______--______--______--</code>)</td></tr>
</tbody></table>
<p>Sound Length = (64-t1)*(1/256) seconds. The Length value is used only if
Bit 6 in NR24 is set.</p>
<h3 id="ff17---nr22---channel-2-volume-envelope-rw"><a class="header" href="#ff17---nr22---channel-2-volume-envelope-rw">FF17 - NR22 - Channel 2 Volume Envelope (R/W)</a></h3>
<pre><code>Bit 7-4 - Initial Volume of envelope (0-0Fh) (0=No Sound)
Bit 3   - Envelope Direction (0=Decrease, 1=Increase)
Bit 2-0 - Number of envelope sweep (n: 0-7)
          (If zero, stop envelope operation.)
</code></pre>
<p>Length of 1 step = n*(1/64) seconds</p>
<h3 id="ff18---nr23---channel-2-frequency-lo-data-w"><a class="header" href="#ff18---nr23---channel-2-frequency-lo-data-w">FF18 - NR23 - Channel 2 Frequency lo data (W)</a></h3>
<p>Frequency’s lower 8 bits of 11 bit data (x). Next 3 bits are in NR24
($FF19).</p>
<h3 id="ff19---nr24---channel-2-frequency-hi-data-rw"><a class="header" href="#ff19---nr24---channel-2-frequency-hi-data-rw">FF19 - NR24 - Channel 2 Frequency hi data (R/W)</a></h3>
<pre><code>Bit 7   - Initial (1=Restart Sound)     (Write Only)
Bit 6   - Counter/consecutive selection (Read/Write)
          (1=Stop output when length in NR21 expires)
Bit 2-0 - Frequency's higher 3 bits (x) (Write Only)
</code></pre>
<p>Frequency = 131072/(2048-x) Hz</p>
<h2 id="sound-channel-3---wave-output"><a class="header" href="#sound-channel-3---wave-output">Sound Channel 3 - Wave Output</a></h2>
<p>This channel can be used to output digital sound, the length of the
sample buffer (Wave RAM) is limited to 32 digits. This sound channel can
be also used to output normal tones when initializing the Wave RAM by a
square wave. This channel doesn’t have a volume envelope register.</p>
<h3 id="ff1a---nr30---channel-3-sound-onoff-rw"><a class="header" href="#ff1a---nr30---channel-3-sound-onoff-rw">FF1A - NR30 - Channel 3 Sound on/off (R/W)</a></h3>
<pre><code>Bit 7 - Sound Channel 3 Off  (0=Stop, 1=Playback)  (Read/Write)
</code></pre>
<h3 id="ff1b---nr31---channel-3-sound-length-w"><a class="header" href="#ff1b---nr31---channel-3-sound-length-w">FF1B - NR31 - Channel 3 Sound Length (W)</a></h3>
<pre><code>Bit 7-0 - Sound length (Write only) (t1: 0 - 255)
</code></pre>
<p>Sound Length = (256-t1)*(1/256) seconds This value is used only if Bit
6 in NR34 is set.</p>
<h3 id="ff1c---nr32---channel-3-select-output-level-rw"><a class="header" href="#ff1c---nr32---channel-3-select-output-level-rw">FF1C - NR32 - Channel 3 Select output level (R/W)</a></h3>
<pre><code>Bits 6-5 - Select output level (Read/Write)
</code></pre>
<table><thead><tr><th>Bits 6-5</th><th>Output level</th></tr></thead><tbody>
<tr><td>%00</td><td>Mute (No sound)</td></tr>
<tr><td>%01</td><td>100% volume (Produce Wave Pattern RAM Data as it is)</td></tr>
<tr><td>%10</td><td>50% volume (Produce Wave Pattern RAM data shifted once to the right)</td></tr>
<tr><td>%11</td><td>25% volume (Produce Wave Pattern RAM data shifted twice to the right)</td></tr>
</tbody></table>
<h3 id="ff1d---nr33---channel-3-frequencys-lower-data-w"><a class="header" href="#ff1d---nr33---channel-3-frequencys-lower-data-w">FF1D - NR33 - Channel 3 Frequency’s lower data (W)</a></h3>
<p>Lower 8 bits of an 11 bit frequency (x).</p>
<h3 id="ff1e---nr34---channel-3-frequencys-higher-data-rw"><a class="header" href="#ff1e---nr34---channel-3-frequencys-higher-data-rw">FF1E - NR34 - Channel 3 Frequency’s higher data (R/W)</a></h3>
<pre><code>Bit 7   - Initial (1=Restart Sound)     (Write Only)
Bit 6   - Counter/consecutive selection (Read/Write)
          (1=Stop output when length in NR31 expires)
Bit 2-0 - Frequency's higher 3 bits (x) (Write Only)
</code></pre>
<p>Frequency = 4194304/(64*(2048-x)) Hz = 65536/(2048-x) Hz</p>
<h3 id="ff30-ff3f---wave-pattern-ram"><a class="header" href="#ff30-ff3f---wave-pattern-ram">FF30-FF3F - Wave Pattern RAM</a></h3>
<pre><code>Contents - Waveform storage for arbitrary sound data
</code></pre>
<p>This storage area holds 32 4-bit samples that are played back, upper 4
bits first.</p>
<p>Wave RAM should only be accessed while CH3 is disabled (NR30 bit 7
reset), otherwise accesses will behave weirdly.</p>
<p>On almost all models, the byte will be written at the offset CH3 is
currently reading. On GBA, the write will simply be ignored.</p>
<h2 id="sound-channel-4---noise"><a class="header" href="#sound-channel-4---noise">Sound Channel 4 - Noise</a></h2>
<p>This channel is used to output white noise. This is done by randomly
switching the amplitude between high and low at a given frequency.
Depending on the frequency the noise will appear “harder” or
“softer”.</p>
<p>It is also possible to influence the function of the random generator,
so the that the output becomes more regular, resulting in a limited
ability to output Tone instead of Noise.</p>
<h3 id="ff20---nr41---channel-4-sound-length-w"><a class="header" href="#ff20---nr41---channel-4-sound-length-w">FF20 - NR41 - Channel 4 Sound Length (W)</a></h3>
<pre><code>Bit 5-0 - Sound length data (Write only) (t1: 0-63)
</code></pre>
<p>Sound Length = (64-t1)*(1/256) seconds The Length value is used only if
Bit 6 in NR44 is set.</p>
<h3 id="ff21---nr42---channel-4-volume-envelope-rw"><a class="header" href="#ff21---nr42---channel-4-volume-envelope-rw">FF21 - NR42 - Channel 4 Volume Envelope (R/W)</a></h3>
<pre><code> Bit 7-4 - Initial Volume of envelope (0-0Fh) (0=No Sound)
 Bit 3   - Envelope Direction (0=Decrease, 1=Increase)
 Bit 2-0 - Number of envelope sweep (n: 0-7)
           (If zero, stop envelope operation.)
</code></pre>
<p>Length of 1 step = n*(1/64) seconds</p>
<h3 id="ff22---nr43---channel-4-polynomial-counter-rw"><a class="header" href="#ff22---nr43---channel-4-polynomial-counter-rw">FF22 - NR43 - Channel 4 Polynomial Counter (R/W)</a></h3>
<p>The amplitude is randomly switched between high and low at the given
frequency. A higher frequency will make the noise to appear “softer”.
When Bit 3 is set, the output will become more regular, and some
frequencies will sound more like Tone than Noise.</p>
<pre><code>Bit 7-4 - Shift Clock Frequency (s)
Bit 3   - Counter Step/Width (0=15 bits, 1=7 bits)
Bit 2-0 - Dividing Ratio of Frequencies (r)
</code></pre>
<p>Frequency = 524288 Hz / r / 2^(s+1) ;For r=0 assume r=0.5 instead</p>
<h3 id="ff23---nr44---channel-4-counterconsecutive-inital-rw"><a class="header" href="#ff23---nr44---channel-4-counterconsecutive-inital-rw">FF23 - NR44 - Channel 4 Counter/consecutive; Inital (R/W)</a></h3>
<pre><code>Bit 7   - Initial (1=Restart Sound)     (Write Only)
Bit 6   - Counter/consecutive selection (Read/Write)
          (1=Stop output when length in NR41 expires)
</code></pre>
<h2 id="sound-control-registers"><a class="header" href="#sound-control-registers">Sound Control Registers</a></h2>
<h3 id="ff24---nr50---channel-control--on-off--volume-rw"><a class="header" href="#ff24---nr50---channel-control--on-off--volume-rw">FF24 - NR50 - Channel control / ON-OFF / Volume (R/W)</a></h3>
<p>The volume bits specify the “Master Volume” for Left/Right sound
output. SO2 goes to the left headphone, and SO1 goes to the right.</p>
<pre><code>Bit 7   - Output Vin to SO2 terminal (1=Enable)
Bit 6-4 - SO2 output level (volume)  (0-7)
Bit 3   - Output Vin to SO1 terminal (1=Enable)
Bit 2-0 - SO1 output level (volume)  (0-7)
</code></pre>
<p>The Vin signal is an analog signal received from the game cartridge bus,
allowing external hardware in the cartridge to supply a fifth sound
channel, additionally to the Game Boy’s internal four channels. No
licensed games used this feature, and it was omitted from the Game Boy
Advance.</p>
<p>(Despite rumors, <em>Pocket Music</em> does not use Vin. It blocks use on the
GBA for a different reason: the developer couldn’t figure out how to
silence buzzing associated with the wave channel’s DAC.)</p>
<h3 id="ff25---nr51---selection-of-sound-output-terminal-rw"><a class="header" href="#ff25---nr51---selection-of-sound-output-terminal-rw">FF25 - NR51 - Selection of Sound output terminal (R/W)</a></h3>
<p>Each channel can be panned hard left, center, or hard right.</p>
<pre><code>Bit 7 - Output sound 4 to SO2 terminal
Bit 6 - Output sound 3 to SO2 terminal
Bit 5 - Output sound 2 to SO2 terminal
Bit 4 - Output sound 1 to SO2 terminal
Bit 3 - Output sound 4 to SO1 terminal
Bit 2 - Output sound 3 to SO1 terminal
Bit 1 - Output sound 2 to SO1 terminal
Bit 0 - Output sound 1 to SO1 terminal
</code></pre>
<h3 id="ff26---nr52---sound-onoff"><a class="header" href="#ff26---nr52---sound-onoff">FF26 - NR52 - Sound on/off</a></h3>
<p>If your GB programs don’t use sound then write 00h to this register to
save 16% or more on GB power consumption. Disabling the sound
controller by clearing Bit 7 destroys the contents of all sound
registers. Also, it is not possible to access any sound registers
(execpt FF26) while the sound controller is disabled.</p>
<pre><code> Bit 7 - All sound on/off  (0: stop all sound circuits) (Read/Write)
 Bit 3 - Sound 4 ON flag (Read Only)
 Bit 2 - Sound 3 ON flag (Read Only)
 Bit 1 - Sound 2 ON flag (Read Only)
 Bit 0 - Sound 1 ON flag (Read Only)
</code></pre>
<p>Bits 0-3 of this register are read only status bits, writing to these
bits does NOT enable/disable sound. The flags get set when sound output
is restarted by setting the Initial flag (Bit 7 in NR14-NR44), the flag
remains set until the sound length has expired (if enabled). A volume
envelopes which has decreased to zero volume will NOT cause the sound
flag to go off.</p>
<h2 id="pitfalls"><a class="header" href="#pitfalls">Pitfalls</a></h2>
<ul>
<li>Enabling or disabling a DAC (resetting NR30 bit 7 or writing %0000
0XXX to NRx2 for other channels), adding or removing it using NR51,
or changing the volume in NR50, will cause an audio pop. (This
causes a change in DC offset, which is smoothed out by a high-pass
circuit over time, but still creates a pop)</li>
<li>The final output goes through a high-pass filter, which is more
aggressive on GBA than on GBC, which is more aggressive than on DMG.
(What this means is that the output is “pulled” towards 0V with
various degrees of “aggressiveness”)</li>
<li>When first starting up a pulse channel, it will <em>always</em> output a
(digital) zero.</li>
<li>The pulse channels’ “duty step” (at which position in the duty
cycle they are) can’t be reset. The exception to this is turning
off the APU, which causes them to start over from 0 when turning it
on.</li>
<li>Restarting a pulse channel causes its “duty step timer” to reset,
meaning that “tickling” a pulse channel regularly enough will
cause its “duty step” to never advance.</li>
<li>When restarting CH3, it resumes playing the last 4-bit sample it
read from wave RAM, or 0 if no sample has been read since APU reset.
(Sample latching is independent of output level control in NR32.)
After the latched sample completes, it starts with the second sample
in wave RAM (low 4 bits of $FF30). The first sample (high 4 bits of
$FF30) is played last.</li>
<li>CH3 output level control does not, in fact, alter the output level.
It shifts the <strong>digital</strong> value CH3 is outputting (read below), not
the analog value.</li>
<li>On GBA, CH3 is inverted. This causes the channel to output a loud
spike when disabled; it’s a good idea to “remove” the channel
using NR51 before refreshing wave RAM.</li>
</ul>
<h2 id="apu-technical-explanation"><a class="header" href="#apu-technical-explanation">APU technical explanation</a></h2>
<p align="center">
<img src="imgs/gb_apu.png">
<br>
  <i>Source: Lior Halphon</i>
</p>
<h3 id="game-boy-game-boy-color"><a class="header" href="#game-boy-game-boy-color">Game Boy, Game Boy Color</a></h3>
<p>Each of the 4 channels work pretty identically. First, there’s a
“generation” circuit, which usually outputs either a 0 or another
value (CH3 differs in that it can output multiple values, but
regardless). That value is digital, and can range between 0 and 0xF.
This is then fed to a
<a href="https://en.wikipedia.org/wiki/Digital-to-analog_converter">DAC</a>, which
maps this to an analog value; 7 maps to the lowest (negative) voltage, 0
to the highest (positive) one. Finally, all channels are mixed through
NR51, scaled through NR50, and sent to the output.</p>
<p>Each DAC is controlled independently from the generation circuit. For
CH3, the DAC is controlled by NR30 bit 7; for other channels, the DAC is
turned on unless bits 3-7 of NRx2 are reset, and the envelope will be
set to <code>[NRx2] &gt;&gt; 4</code>. (Note: the envelope sweep function changes the
envelope, but not the value in NRx2! It won’t disable the DAC, either.)
The generation circuits are turned on by restarting them for the first
time, and this is what sets the corresponding bit in NR52. Yes, it’s
possible to turn on a DAC but not the generation circuit. Finally,
disabling a DAC also kills the generation circuit.</p>
<p>Note that each DAC has a DC offset, so enabling, disabling, adding to or
removing from NR51, will all cause an audio pop; changing the volume in
NR50 will as well.</p>
<p>Finally, all the output goes through a high-pass filter to remove the DC
offsets from the DACs.</p>
<h3 id="game-boy-advance"><a class="header" href="#game-boy-advance">Game Boy Advance</a></h3>
<p>The APU was reworked pretty heavily for the GBA. Instead of mixing being
done analogically, it’s instead done digitally; then, sound is
converted to an analog signal and an offset is added (see SOUNDBIAS in
<a href="http://problemkaputt.de/gbatek.htm#gbasoundcontrolregisters">GBATEK</a>
for more details).</p>
<p>This means that the APU has no DACs, or if modelling the GBA as a GB,
they’re always on.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="pixel_fifo.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="Joypad_Input.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="pixel_fifo.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="Joypad_Input.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
